<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LAM Weekly Chemical Brief</title>
  <style>
    /* â”€â”€ ì „ì—­ ë¦¬ì…‹ â”€â”€ */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: #f4f4f4;         /* ì „ì²´ ë°°ê²½: ë¼ì´íŠ¸ ê·¸ë ˆì´ */
      color: #222222;                    /* ê¸°ë³¸ ê¸€ì: ë‹¤í¬ */
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
    }

    /* â”€â”€ í—¤ë” â”€â”€ */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 24px;
      background: #ffffff;              /* í—¤ë”: í°ìƒ‰ */
      border-bottom: 3px solid #FF8C00;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* íƒ€ì´í‹€ ë°•ìŠ¤ */
    .title-box {
      display: flex;
      align-items: center;
      background: #f8f8f8;
      border: 2px solid #e0e0e0;
      border-radius: 50px;
      padding: 8px 20px 8px 8px;
      gap: 12px;
    }

    /* LAM ë±ƒì§€ */
    .lam-badge {
      background: #FF8C00;
      color: #ffffff;
      font-weight: 900;
      font-size: 22px;
      padding: 6px 18px;
      border-radius: 40px;
      letter-spacing: 1px;
    }

    /* íƒ€ì´í‹€ í…ìŠ¤íŠ¸ */
    .title-text {
      font-size: 22px;
      font-weight: 800;
      color: #222222;
    }
    .title-text span { color: #FF0000; }

    /* í—¤ë” ìš°ì¸¡ ë²„íŠ¼ ê·¸ë£¹ */
    .header-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    /* í˜„ì¬ ì£¼ì°¨ ë°°ì§€ */
    .current-week-badge {
      color: #FF8C00;
      font-size: 13px;
      font-weight: 700;
      padding: 6px 14px;
      border: 2px solid #FF8C00;
      border-radius: 20px;
      background: #fff8f0;
    }

    /* ì£¼ì°¨ ì„ íƒ ë“œë¡­ë‹¤ìš´ */
    .week-selector {
      background: #ffffff;
      color: #FF8C00;
      border: 2px solid #FF8C00;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
    }

    /* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ */
    .btn-refresh {
      background: #ffffff;
      color: #555555;
      border: 1px solid #cccccc;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .btn-refresh:hover { background: #f0f0f0; }

    /* NEW ENTRY ë²„íŠ¼ */
    .btn-new-entry {
      background: #FF0000;
      color: #ffffff;
      border: none;
      padding: 8px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: background 0.2s;
    }
    .btn-new-entry:hover { background: #cc0000; }

    /* â”€â”€ ë©”ì¸ ì½˜í…ì¸  â”€â”€ */
    .main-content {
      padding: 20px 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* â”€â”€ í’ˆëª© ì¹´ë“œ ë¸”ë¡ â”€â”€ */
    .item-block {
      margin-bottom: 10px;
      background: #ffffff;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
    }

    /* í’ˆëª©ëª… í—¤ë” í–‰ */
    .item-header-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    /* í’ˆëª©ëª… ë±ƒì§€ */
    .item-name-badge {
      background: #FF8C00;
      color: #ffffff;
      font-weight: 800;
      font-size: 15px;
      padding: 7px 24px;
      border-radius: 6px;
      min-width: 180px;
      text-align: center;
    }

    /* commentary ë¼ë²¨ ë²„íŠ¼ */
    .commentary-label {
      background: #f0f0f0;
      color: #555555;
      border: 1px solid #cccccc;
      padding: 7px 18px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .commentary-label:hover { background: #e0e0e0; }

    /* ê°€ê²©/ë“±ë½/ì½”ë©˜í„°ë¦¬ í–‰ */
    .item-data-row {
      display: flex;
      align-items: stretch;
      gap: 6px;
    }

    /* ê°€ê²© ë°•ìŠ¤ */
    .price-box {
      background: #fff8f0;
      color: #222222;
      border: 1px solid #ffe0b2;
      font-weight: 700;
      font-size: 15px;
      padding: 10px 20px;
      border-radius: 6px;
      min-width: 130px;
      text-align: center;
      line-height: 1.4;
    }

    /* ë“±ë½ ë°•ìŠ¤ */
    .change-box {
      background: #f8f8f8;
      border: 1px solid #e0e0e0;
      font-weight: 700;
      font-size: 14px;
      padding: 10px 16px;
      border-radius: 6px;
      min-width: 110px;
      text-align: center;
      line-height: 1.4;
    }

    /* ë“±ë½ ìƒ‰ìƒ */
    .change-positive { color: #FF0000; }
    .change-negative { color: #0055FF; }
    .change-neutral  { color: #999999; }

    /* ì½”ë©˜í„°ë¦¬ ì…ë ¥ ë°•ìŠ¤ */
    .commentary-input {
      flex: 1;
      background: #fafafa;
      color: #222222;
      border: 1px solid #dddddd;
      border-radius: 6px;
      padding: 10px 14px;
      font-size: 13px;
      outline: none;
      resize: none;
      transition: border 0.2s;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .commentary-input:focus {
      border-color: #FF8C00;
      box-shadow: 0 0 0 2px rgba(255,140,0,0.15);
      background: #ffffff;
    }

    /* â”€â”€ ëª¨ë‹¬ ë°°ê²½ â”€â”€ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-overlay.active { display: flex; }

    /* ëª¨ë‹¬ ë°•ìŠ¤ */
    .modal-box {
      background: #ffffff;
      border: 2px solid #FF8C00;
      border-radius: 10px;
      padding: 28px;
      width: 700px;
      max-width: 95vw;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    }

    /* ëª¨ë‹¬ ì œëª© */
    .modal-title {
      color: #FF8C00;
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
      border-bottom: 2px solid #ffe0b2;
      padding-bottom: 10px;
    }

    /* ëª¨ë‹¬ ì£¼ì°¨ ì…ë ¥ */
    .modal-week-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .modal-week-label {
      color: #FF8C00;
      font-weight: 700;
      font-size: 14px;
      min-width: 60px;
    }

    /* ëª¨ë‹¬ ì…ë ¥ í•„ë“œ */
    .modal-input {
      background: #fafafa;
      color: #222222;
      border: 1px solid #cccccc;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 13px;
      outline: none;
      width: 100%;
    }
    .modal-input:focus { border-color: #FF8C00; background: #ffffff; }

    /* ëª¨ë‹¬ ì»¬ëŸ¼ í—¤ë” */
    .modal-grid-header {
      display: grid;
      grid-template-columns: 150px 1fr;
      gap: 6px;
      margin-bottom: 6px;
    }

    .modal-col-header {
      color: #999999;
      font-size: 11px;
      text-align: center;
    }

    /* ëª¨ë‹¬ í’ˆëª© ì…ë ¥ ê·¸ë¦¬ë“œ */
    .modal-item-row {
      display: grid;
      grid-template-columns: 150px 110px 1fr;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
    }

    /* ëª¨ë‹¬ í’ˆëª©ëª… ë¼ë²¨ */
    .modal-item-label {
      background: #FF8C00;
      color: #ffffff;
      font-weight: 700;
      font-size: 13px;
      padding: 8px 12px;
      border-radius: 6px;
      text-align: center;
    }

    /* ëª¨ë‹¬ ë²„íŠ¼ ì˜ì—­ */
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      border-top: 1px solid #eeeeee;
      padding-top: 16px;
    }

    .btn-cancel {
      background: #f0f0f0;
      color: #555555;
      border: 1px solid #cccccc;
      padding: 9px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-cancel:hover { background: #e0e0e0; }

    .btn-save {
      background: #FF8C00;
      color: #ffffff;
      border: none;
      padding: 9px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
    }
    .btn-save:hover { background: #e07b00; }

    /* â”€â”€ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ â”€â”€ */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: #FF8C00;
      color: #ffffff;
      padding: 12px 22px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 14px;
      z-index: 9999;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to   { transform: translateY(0);    opacity: 1; }
    }

    /* ë¡œë”© í…ìŠ¤íŠ¸ */
    .loading-text {
      color: #FF8C00;
      font-size: 14px;
      text-align: center;
      padding: 40px;
    }

    /* ë“±ë½ ì—†ìŒ í‘œì‹œ */
    .no-change { color: #bbbbbb; font-size: 12px; }

    /* ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .header { flex-wrap: wrap; gap: 10px; }
      .title-text { font-size: 16px; }
      .lam-badge  { font-size: 16px; }
      .modal-item-row { grid-template-columns: 110px 90px 1fr; }
    }
  </style>
</head>
<body>

<!-- â”€â”€ í—¤ë” â”€â”€ -->
<div class="header">
  <div class="title-box">
    <div class="lam-badge">LAM</div>
    <div class="title-text">Weekly <span>Chemical</span> Brief</div>
  </div>
  <div class="header-buttons">
    <span class="current-week-badge" id="currentWeekLabel">--</span>
    <select class="week-selector" id="weekSelector" onchange="loadWeekData(this.value)">
      <option value="">ì£¼ì°¨ ì„ íƒ</option>
    </select>
    <button class="btn-refresh" onclick="refreshData()">â†» ìƒˆë¡œê³ ì¹¨</button>
    <button class="btn-new-entry" onclick="openModal()">+NEW ENTRY</button>
  </div>
</div>

<!-- â”€â”€ ë©”ì¸ ì½˜í…ì¸  â”€â”€ -->
<div class="main-content" id="mainContent">
  <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</div>

<!-- â”€â”€ NEW ENTRY ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box">
    <div class="modal-title">ğŸ“‹ ì£¼ê°„ ë°ì´í„° ì…ë ¥ (NEW ENTRY)</div>

    <!-- ì£¼ì°¨ ì…ë ¥ -->
    <div class="modal-week-row">
      <span class="modal-week-label">ì£¼ì°¨</span>
      <input type="text" class="modal-input" id="modalWeek"
             placeholder="ì˜ˆ: 2026-W09" style="width:160px;">
      <button onclick="setCurrentWeek()"
              style="background:#fff8f0;color:#FF8C00;border:2px solid #FF8C00;
                     padding:8px 12px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:700;">
        ì´ë²ˆ ì£¼
      </button>
    </div>

    <!-- ì»¬ëŸ¼ í—¤ë” -->
    <div style="display:grid;grid-template-columns:150px 110px 1fr;gap:6px;margin-bottom:6px;">
      <div style="color:#999;font-size:11px;text-align:center;">í’ˆëª©</div>
      <div style="color:#999;font-size:11px;text-align:center;">ê°€ê²©</div>
      <div style="color:#999;font-size:11px;text-align:center;">Commentary</div>
    </div>

    <!-- í’ˆëª© ì…ë ¥ í–‰ -->
    <div id="modalItemRows"></div>

    <div style="background:#fff8f0;border:1px solid #ffe0b2;border-radius:6px;padding:10px 14px;margin-top:12px;font-size:12px;color:#888;">
      ğŸ’¡ ë“±ë½(change)ì€ ì´ì „ ì£¼ì°¨ ê°€ê²©ê³¼ ë¹„êµí•˜ì—¬ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
    </div>

    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="btn-save"   onclick="saveEntry()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ -->
<div class="toast" id="toastMsg"></div>

<script>
  // ============================================================
  // â˜… ë°˜ë“œì‹œ ë³¸ì¸ GAS ë°°í¬ URLë¡œ êµì²´í•˜ì„¸ìš”!
  // ============================================================
  var GAS_URL = 'https://script.google.com/macros/s/AKfycbxTZjLHMxfRCAvM1FietPXm7XVvLm-BeaD8Yyue2BBujzyyhDycj3Hm9arp5SsqQqOf/exec';

  // í’ˆëª© ëª©ë¡
  var ITEMS = ['WTI', 'Styrene', 'Acrylonitrile', 'Butadiene', 'BPA', 'MMA'];

  // í’ˆëª©ë³„ ë‹¨ìœ„
  var UNITS = {
    'WTI':           '$/bbl',
    'Styrene':       '$/MT',
    'Acrylonitrile': '$/MT',
    'Butadiene':     '$/MT',
    'BPA':           '$/MT',
    'MMA':           '$/MT'
  };

  var currentWeek = '';

  // â”€â”€ í˜ì´ì§€ ë¡œë“œ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.addEventListener('DOMContentLoaded', function() {
    buildModalRows();
    loadWeekList();
  });

  // â”€â”€ GAS API í˜¸ì¶œ (GET ë°©ì‹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function callGAS(payload) {
    try {
      var url = GAS_URL + '?data=' + encodeURIComponent(JSON.stringify(payload));
      var res = await fetch(url, { method: 'GET', redirect: 'follow' });
      var text = await res.text();
      return JSON.parse(text);
    } catch (err) {
      showToast('âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ' + err.message);
      return { success: false };
    }
  }

  // â”€â”€ ì£¼ì°¨ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadWeekList() {
    var result = await callGAS({ action: 'getWeekList' });

    if (result.success) {
      var selector = document.getElementById('weekSelector');
      selector.innerHTML = '<option value="">ì£¼ì°¨ ì„ íƒ</option>';
      result.weeks.forEach(function(week) {
        var opt = document.createElement('option');
        opt.value = week;
        opt.textContent = week;
        selector.appendChild(opt);
      });

      if (result.weeks.length > 0) {
        selector.value = result.weeks[0];
        loadWeekData(result.weeks[0]);
      } else {
        renderEmptyData();
      }
    } else {
      renderEmptyData();
    }
  }

  // â”€â”€ íŠ¹ì • ì£¼ì°¨ ë°ì´í„° ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadWeekData(week) {
    if (!week) return;
    currentWeek = week;
    document.getElementById('mainContent').innerHTML =
      '<div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

    var result = await callGAS({ action: 'getData', week: week });

    if (result.success) {
      currentWeek = result.week;
      document.getElementById('currentWeekLabel').textContent = result.week;
      renderData(result.items);
    } else {
      showToast('âš ï¸ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨');
      renderEmptyData();
    }
  }

  // â”€â”€ ë°ì´í„° ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderData(items) {
    var html = '';

    ITEMS.forEach(function(itemName) {
      var d          = items[itemName] || {};
      var price      = d.price;
      var unit       = d.unit || UNITS[itemName];
      var changeAbs  = d.change_abs;
      var changePct  = d.change_pct;
      var commentary = d.commentary || '';

      // ê°€ê²© í‘œì‹œ
      var priceDisplay = (price !== '' && price !== null && price !== undefined)
        ? price + '<br><span style="font-size:11px;color:#888;font-weight:500;">(' + unit + ')</span>'
        : '-<br><span style="font-size:11px;color:#bbb;">(' + unit + ')</span>';

      // ë“±ë½ í‘œì‹œ
      var changeAbsStr, changePctStr, changeClass;
      if (changeAbs !== '' && changeAbs !== null && changeAbs !== undefined) {
        changeAbsStr = formatChange(changeAbs);
        changePctStr = formatChangePct(changePct);
        changeClass  = getChangeClass(changeAbs);
      } else {
        changeAbsStr = '-';
        changePctStr = '-%';
        changeClass  = 'change-neutral';
      }

      html += `
      <div class="item-block">
        <div class="item-header-row">
          <div class="item-name-badge">${itemName}</div>
          <button class="commentary-label" onclick="focusCommentary('${itemName}')">
            commentary
          </button>
        </div>
        <div class="item-data-row">
          <div class="price-box">${priceDisplay}</div>
          <div class="change-box ${changeClass}">
            ${changeAbsStr}<br>
            <span style="font-size:12px;">(${changePctStr})</span>
          </div>
          <textarea
            class="commentary-input"
            id="commentary_${itemName}"
            rows="2"
            placeholder="ì½”ë©˜í„°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
            onblur="saveCommentary('${itemName}', this.value)"
          >${escapeHtml(String(commentary))}</textarea>
        </div>
      </div>`;
    });

    document.getElementById('mainContent').innerHTML = html;
  }

  // â”€â”€ ë¹ˆ ë°ì´í„° ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderEmptyData() {
    var emptyItems = {};
    ITEMS.forEach(function(item) {
      emptyItems[item] = { price: '', unit: UNITS[item], change_abs: '', change_pct: '', commentary: '' };
    });
    document.getElementById('currentWeekLabel').textContent = getCurrentWeekStr();
    renderData(emptyItems);
  }

  // â”€â”€ ì½”ë©˜í„°ë¦¬ ìë™ ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function saveCommentary(item, value) {
    if (!currentWeek || currentWeek === '--') return;
    await callGAS({ action: 'updateCommentary', week: currentWeek, item: item, commentary: value });
  }

  // â”€â”€ ìƒˆë¡œê³ ì¹¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function refreshData() {
    loadWeekList();
    showToast('âœ… ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
  }

  // â”€â”€ ì½”ë©˜í„°ë¦¬ í¬ì»¤ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function focusCommentary(itemName) {
    var el = document.getElementById('commentary_' + itemName);
    if (el) el.focus();
  }

  // â”€â”€ ë“±ë½ í¬ë§·íŒ… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function formatChange(val) {
    var n = parseFloat(val);
    if (isNaN(n)) return String(val);
    return (n >= 0 ? '+' : '') + n.toFixed(1);
  }

  function formatChangePct(val) {
    var n = parseFloat(val);
    if (isNaN(n)) return String(val) + '%';
    return (n >= 0 ? '+' : '') + n.toFixed(1) + '%';
  }

  // â”€â”€ ë“±ë½ CSS í´ë˜ìŠ¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getChangeClass(val) {
    var n = parseFloat(val);
    if (isNaN(n) || val === '' || val === null || val === undefined) return 'change-neutral';
    if (n > 0) return 'change-positive';
    if (n < 0) return 'change-negative';
    return 'change-neutral';
  }

  // â”€â”€ HTML ì´ìŠ¤ì¼€ì´í”„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function escapeHtml(str) {
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // â”€â”€ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function openModal() {
    setCurrentWeek();
    clearModalInputs();
    document.getElementById('modalOverlay').classList.add('active');
  }

  function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
  }

  function setCurrentWeek() {
    document.getElementById('modalWeek').value = getCurrentWeekStr();
  }

  // â”€â”€ í˜„ì¬ ì£¼ì°¨ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function getCurrentWeekStr() {
    var now = new Date();
    var startOfYear = new Date(now.getFullYear(), 0, 1);
    var weekNum = Math.ceil(((now - startOfYear) / 86400000 + startOfYear.getDay() + 1) / 7);
    return now.getFullYear() + '-W' + String(weekNum).padStart(2, '0');
  }

  // â”€â”€ ëª¨ë‹¬ í’ˆëª© ì…ë ¥í–‰ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function buildModalRows() {
    var container = document.getElementById('modalItemRows');
    var html = '';
    ITEMS.forEach(function(itemName) {
      html += `
      <div class="modal-item-row">
        <div class="modal-item-label">${itemName}</div>
        <input type="number" step="0.01"
               class="modal-input" id="modal_price_${itemName}"
               placeholder="${UNITS[itemName]}">
        <input type="text"
               class="modal-input" id="modal_comm_${itemName}"
               placeholder="ì½”ë©˜í„°ë¦¬">
      </div>`;
    });
    container.innerHTML = html;
  }

  // â”€â”€ ëª¨ë‹¬ ì…ë ¥ê°’ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function clearModalInputs() {
    ITEMS.forEach(function(itemName) {
      ['modal_price_', 'modal_comm_'].forEach(function(prefix) {
        var el = document.getElementById(prefix + itemName);
        if (el) el.value = '';
      });
    });
  }

  // â”€â”€ ëª¨ë‹¬ ì €ì¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function saveEntry() {
    var week = document.getElementById('modalWeek').value.trim();
    if (!week) { showToast('âš ï¸ ì£¼ì°¨ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

    var itemsData = {};
    ITEMS.forEach(function(itemName) {
      itemsData[itemName] = {
        price:      document.getElementById('modal_price_' + itemName).value,
        commentary: document.getElementById('modal_comm_'  + itemName).value
      };
    });

    showToast('ì €ì¥ ì¤‘...');
    var result = await callGAS({ action: 'saveEntry', data: { week: week, items: itemsData } });

    if (result.success) {
      showToast('âœ… ' + result.message);
      closeModal();
      await loadWeekList();
      document.getElementById('weekSelector').value = week;
      loadWeekData(week);
    } else {
      showToast('âš ï¸ ì €ì¥ ì‹¤íŒ¨: ' + (result.message || 'ì˜¤ë¥˜ ë°œìƒ'));
    }
  }

  // â”€â”€ ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('modalOverlay').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
  });

  // â”€â”€ í† ìŠ¤íŠ¸ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showToast(msg) {
    var toast = document.getElementById('toastMsg');
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(window._toastTimer);
    window._toastTimer = setTimeout(function() { toast.style.display = 'none'; }, 3000);
  }
</script>
</body>
</html>
